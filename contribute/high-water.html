---
# jekyll
layout: default
permalink: /contribute/high-water/

# page
title: High Water
description: Contribute a high water point.
menu: false
---
<div class="row justify-content-md-center">
  <div class="col-md-8 col-lg-6">
    <h4>Contribute</h4>
    <p>You can help....</p>

    <form id="contribute-form" autocomplete="off">
      <fieldset>
        <legend>Your information</legend>

        <div class="mb-3">
          <label for="name-input" class="form-label">Name<span class="text-danger">* required</span></label>
          <input type="text" name="NAME" class="form-control" id="name-input" required>
        </div>

        <div class="mb-3">
          <label for="email-input" class="form-label">Email<span class="text-danger">*</span></label>
          <input type="email" name="EMAIL" class="form-control" id="email-input" required>
        </div>

        <div class="mb-3">
          <label for="phone-input" class="form-label">Phone<span class="text-danger">*</span></label>
          <input type="tel" pattern="[0-9]{3}-[0-9]{3}-[0-9]{4}" name="PHONE" class="form-control" id="phone-input"
            required>
          <small class="form-text text-muted">Must be in <em>503-555-5555</em> format.</small>
        </div>

      </fieldset>
      <fieldset>
        <legend>Flood information</legend>

        <div class="mb-3">
          <label for="event-select" class="form-label">Event<span class="text-danger">*</span></label>
          <select name="EVENT" class="form-control" id="event-select">
            <option value="2015">December 15, 2015</option>
            <option value="2007">November 7, 2007</option>
            <option value="1996">February 3, 1996</option>
          </select>
          <small class="form-text text-muted">Note any unlisted event date in the <em>Notes</em> below.</small>
        </div>

        <div class="mb-3">
          <label for="location-input" class="form-label">Location<span class="text-danger">*</span></label>
          <input type="text" name="LOCATION" class="form-control" id="location-input" readonly required>
          <small class="form-text text-muted">Navigate to the location in the map below and click to choose a
            location.</small>
        </div>

        <div id="contribute-location-map"></div>

        <div class="mb-3">
          <label for="height-input" class="form-label">Height<span class="text-danger">*</span></label>
          <input type="number" step="1" min="0" name="HEIGHT" value="0" class="form-control" id="height-input" required>
          <small class="form-text text-muted">Height of water at the location in inches. Enter <em>0</em> to indicate
            extent of water at the location.</small>
        </div>

      </fieldset>
      <fieldset>
        <legend>Additional information</legend>

        <div class="mb-3">
          <label for="notes-input" class="form-label">Notes</label>
          <textarea type="text" name="NAME" class="form-control" id="notes-input" maxlength="500"></textarea>
          <small class="form-text text-muted">Any details specifically concerning the high water event at the specified
            location.</small>
        </div>

        <div class="mb-3">
          <label for="photo-input" class="form-label">Photo</label>
          <input type="file" accept="image/jpeg" name="PHOTO" class="form-control" id="photo-input">
          <small class="form-text text-muted">Only include a photo which shows a high water mark or reference mark at
            the location.</small>
        </div>

        <button type="submit" class="btn btn-primary mt-1">Submit</button>
      </fieldset>
    </form>
  </div>
</div>

<link rel="stylesheet" href="https://js.arcgis.com/4.23/esri/themes/light/main.css">

<script type="module">
  import esriConfig from 'https://js.arcgis.com/4.23/@arcgis/core/config.js';
  import { whenOnce } from 'https://js.arcgis.com/4.23/@arcgis/core/core/watchUtils.js';
  import Map from 'https://js.arcgis.com/4.23/@arcgis/core/Map.js';
  import MapView from 'https://js.arcgis.com/4.23/@arcgis/core/views/MapView.js';
  import Basemap from 'https://js.arcgis.com/4.23/@arcgis/core/Basemap.js';
  import MapImageLayer from 'https://js.arcgis.com/4.23/@arcgis/core/layers/MapImageLayer.js';
  import FeatureLayer from 'https://js.arcgis.com/4.23/@arcgis/core/layers/FeatureLayer.js';
  import Graphic from 'https://js.arcgis.com/4.23/@arcgis/core/Graphic.js';
  import { contains } from 'https://js.arcgis.com/4.23/@arcgis/core/geometry/geometryEngine.js'

  import Search from 'https://js.arcgis.com/4.23/@arcgis/core/widgets/Search.js';
  import BasemapToggle from 'https://js.arcgis.com/4.23/@arcgis/core/widgets/BasemapToggle.js';

  esriConfig.portalUrl = 'https://gis.vernonia-or.gov/portal';

  const container = document.getElementById('contribute-location-map');
  const form = document.getElementById('contribute-form');
  const input = document.getElementById('location-input');

  form.addEventListener('submit', (event) => {
    event.preventDefault();
    console.log(event);
  });

  const load = async () => {

    const base = new MapImageLayer({
      url: 'https://gis.vernonia-or.gov/server/rest/services/UpperNehalemFlood/UNF_Base/MapServer',
    });

    const boundary = new FeatureLayer({
      url: 'https://gis.vernonia-or.gov/server/rest/services/UpperNehalemFlood/UNF_Base/MapServer/1',
    });

    await boundary.load();

    const query = await boundary.queryFeatures({
      where: '1 = 1',
      returnGeometry: true,
      num: 1,
    });

    const boundaryGeometry = query.features[0].geometry;

    const view = new MapView({
      container: container,
      map: new Map({
        basemap: new Basemap({
          portalItem: {
            id: '6e9f78f3a26f48c89575941141fd4ac3',
          },
        }),
        layers: [base],
        ground: 'world-elevation',
      }),
      extent: boundary.fullExtent,
      constraints: {
        rotationEnabled: false,
      },
    });

    const search = new Search({
      view: view,
      locationEnabled: false,
      popupEnabled: false,
      resultGraphicEnabled: false,
    });

    view.ui.add(search, 'top-right');

    whenOnce(search, 'defaultSources.length', () => {
      search.defaultSources.forEach((source) => {
        source.filter = {
          geometry: boundary.fullExtent,
        };
      });
    });

    const basemapToggle = new BasemapToggle({
      view: view,
      nextBasemap: new Basemap({
        portalItem: {
          id: '2622b9aecacd401583981410e07d5bb9',
        },
      }),
    });

    view.ui.add(basemapToggle, 'bottom-right');

    view.on('click', (event) => {
      view.graphics.removeAll();

      input.value = '';

      const point = event.mapPoint;

      const contained = contains(boundaryGeometry, point);

      if (!contained) {
        return;
      }

      input.value = `${point.longitude.toPrecision(9)},${point.latitude.toPrecision(9)}`;

      view.graphics.add(
        new Graphic({
          geometry: point,
          symbol: {
            type: 'simple-marker',
            style: 'circle',
            color: [0, 0, 255, 0.4],
            size: 12,
            outline: {
              color: 'white',
              width: 1,
            },
          },
        }),
      );
    });
  };

  load();
</script>